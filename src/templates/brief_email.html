<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ app_name }} - Morning Brief</title>
    <!--[if mso]>
    <style type="text/css">
        body, table, td {font-family: Calibri, Arial, sans-serif !important;}
    </style>
    <![endif]-->
    <style type="text/css">
        /* Mobile-friendly font sizes â€” overrides inline styles on iOS/Android */
        @media screen and (max-width: 600px) {
            .body-text, .body-text p, .body-text td {
                font-size: 16px !important;
                line-height: 1.6 !important;
            }
            .overview-text {
                font-size: 16px !important;
                line-height: 1.6 !important;
            }
            .heading-1 {
                font-size: 26px !important;
            }
            .heading-2 {
                font-size: 18px !important;
            }
            .table-text, .table-text td {
                font-size: 14px !important;
            }
            .footer-text {
                font-size: 13px !important;
            }
            .content-cell {
                padding-left: 20px !important;
                padding-right: 20px !important;
            }
        }
    </style>
</head>
<body style="margin: 0; padding: 0; background-color: #f5f5f5; font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 16px; line-height: 1.5; color: #333333; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%;">
    <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #f5f5f5;">
        <tr>
            <td align="center" style="padding: 20px 10px;">
                <!-- Main Container -->
                <!--[if mso]><table role="presentation" width="600" cellpadding="0" cellspacing="0" align="center"><tr><td><![endif]-->
                <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #ffffff; max-width: 600px; margin: 0 auto;">

                    <!-- Header -->
                    <tr>
                        <td class="content-cell" style="padding: 30px 40px 20px 40px; border-bottom: 2px solid #0066cc;">
                            <h1 class="heading-1" style="margin: 0; font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 24pt; font-weight: normal; color: #0066cc;">
                                Nick's Morning Brief
                            </h1>
                            <p class="body-text" style="margin: 10px 0 0 0; font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 16px; color: #666666;">
                                {{ digest_date.strftime('%A, %B %d, %Y') }}
                            </p>
                        </td>
                    </tr>

                    <!-- Overview -->
                    {% if overview %}
                    <tr>
                        <td class="content-cell" style="padding: 30px 40px 20px 40px;">
                            <p class="overview-text" style="margin: 0; padding: 15px; background-color: #f8f9fa; border-left: 3px solid #0066cc; font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 16px; color: #444444; line-height: 1.6;">
                                {{ overview }}
                            </p>
                        </td>
                    </tr>
                    {% endif %}

                    <!-- Topics -->
                    {% for topic in topics %}
                    <tr>
                        <td class="content-cell body-text" style="padding: 10px 40px 30px 40px;">
                            <h2 class="heading-2" style="margin: 0 0 15px 0; padding: 15px 0 10px 0; border-bottom: 1px solid #e0e0e0; font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 14pt; font-weight: bold; color: #333333;">
                                {{ topic.name }}
                            </h2>
                            {% if topic.stats_html %}
                            {{ topic.stats_html | safe }}
                            {% endif %}
                            {{ topic.prose_html | safe }}
                        </td>
                    </tr>
                    {% endfor %}

                    <!-- Routine SEC Filings -->
                    {% if routine_filings %}
                    <tr>
                        <td class="content-cell" style="padding: 10px 40px 30px 40px;">
                            <h2 class="heading-2" style="margin: 0 0 15px 0; padding: 15px 0 10px 0; border-bottom: 1px solid #e0e0e0; font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 14pt; font-weight: bold; color: #333333;">
                                SEC Filings
                            </h2>
                            <table class="table-text" role="presentation" width="100%" cellpadding="6" cellspacing="0" style="font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 14px; border-collapse: collapse;">
                                <tr style="background-color: #f8f9fa;">
                                    <td style="border-bottom: 1px solid #e0e0e0; font-weight: bold; color: #666666;">Company</td>
                                    <td style="border-bottom: 1px solid #e0e0e0; font-weight: bold; color: #666666;">Form</td>
                                    <td style="border-bottom: 1px solid #e0e0e0; font-weight: bold; color: #666666;">Date</td>
                                    <td style="border-bottom: 1px solid #e0e0e0; font-weight: bold; color: #666666;">Details</td>
                                </tr>
                                {% for filing in routine_filings %}
                                <tr>
                                    <td style="border-bottom: 1px solid #f0f0f0; color: #333333;">{{ filing.company }}</td>
                                    <td style="border-bottom: 1px solid #f0f0f0;">
                                        <a href="{{ filing.url }}" style="color: #0066cc; text-decoration: none;">{{ filing.form_type }}</a>
                                    </td>
                                    <td style="border-bottom: 1px solid #f0f0f0; color: #666666;">{{ filing.date }}</td>
                                    <td style="border-bottom: 1px solid #f0f0f0; color: #666666;">{{ filing.description }}</td>
                                </tr>
                                {% endfor %}
                            </table>
                        </td>
                    </tr>
                    {% endif %}

                    <!-- Sources -->
                    {% if sources %}
                    <tr>
                        <td class="content-cell" style="padding: 10px 40px 30px 40px;">
                            <h2 class="heading-2" style="margin: 0 0 15px 0; padding: 15px 0 10px 0; border-bottom: 1px solid #e0e0e0; font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 14pt; font-weight: bold; color: #333333;">
                                Sources
                            </h2>
                            <table class="table-text" role="presentation" width="100%" cellpadding="0" cellspacing="0" style="font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 14px;">
                                {% for source in sources %}
                                <tr>
                                    <td style="padding: 3px 0; color: #666666; line-height: 1.4;">
                                        [{{ source.number }}] <a href="{{ source.url }}" style="color: #0066cc; text-decoration: none;">{{ source.title }}</a> &mdash; {{ source.source_name }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </table>
                        </td>
                    </tr>
                    {% endif %}

                    <!-- AI Attribution -->
                    <tr>
                        <td class="content-cell" style="padding: 20px 40px; background-color: #f8f9fa; border-top: 1px solid #e0e0e0;">
                            <p class="footer-text" style="margin: 0; font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 13px; color: #666666;">
                                <strong>AI Model:</strong> Synthesis by {{ ai_provider }} ({{ ai_model }})
                            </p>
                        </td>
                    </tr>

                    <!-- Footer -->
                    <tr>
                        <td class="content-cell" style="padding: 25px 40px; background-color: #333333;">
                            <p class="footer-text" style="margin: 0; font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 13px; color: #cccccc; text-align: center;">
                                You're receiving this because you subscribed to {{ app_name }}.
                            </p>
                            <p class="footer-text" style="margin: 10px 0 0 0; font-family: Calibri, 'Segoe UI', Arial, sans-serif; font-size: 13px; color: #cccccc; text-align: center;">
                                Reply to this email to manage your preferences or unsubscribe.
                            </p>
                        </td>
                    </tr>

                </table>
                <!--[if mso]></td></tr></table><![endif]-->
            </td>
        </tr>
    </table>
</body>
</html>
